
[View code on GitHub](https://github.com/solana-labs/solana/tree/master/na/program-runtime)

The `autodoc/solana/program-runtime` folder contains essential modules for executing smart contracts on the Solana blockchain. These modules ensure efficient and secure execution of smart contracts within the Solana program runtime.

For example, the `accounts_data_meter.rs` module tracks and meters the available accounts data space during program runtime. It ensures that the accounts data space does not exceed the maximum allowed size and monitors the amount of available space. Developers can use the `AccountsDataMeter` struct to create a new instance with an initial amount of accounts data space used and adjust the space used by accounts data.

```rust
let mut accounts_data_meter = AccountsDataMeter::new(used_space, max_space);
accounts_data_meter.adjust_space_used(new_space);
```

The `executor_cache.rs` module defines a Least Frequently Used (LFU) cache for storing executors of Solana programs. This cache improves the performance of the Solana runtime by reducing the need to load executors from the database and evicting the least frequently used ones when the cache reaches its capacity. The `BankExecutorCache` struct can be used to add, get, and remove executors from the cache.

```rust
let mut executor_cache = BankExecutorCache::new(capacity);
executor_cache.add(program_id, executor);
let executor = executor_cache.get(&program_id);
executor_cache.remove(&program_id);
```

The `log_collector.rs` module provides a way to collect log messages and limit their size. The `LogCollector` struct collects log messages generated by smart contracts and stores them in a buffer, which can be retrieved and processed by downstream consumers of program logging. The convenience macros, `ic_logger_msg` and `ic_msg`, make it easy to log messages with the `LogCollector` struct.

```rust
ic_logger_msg!(logger, "This is a log message");
ic_msg!(logger, "This is another log message");
```

The `pre_account.rs` module maintains the state of an account before an instruction executes and verifies the account's integrity after the instruction completes. The `PreAccount` struct provides methods like `verify` and `update` to ensure the account's integrity during program execution.

```rust
let pre_account = PreAccount::new(account, owner, rent);
pre_account.verify(&owner, &rent, &new_account, &mut timings)?;
pre_account.update(&new_account);
```

The `prioritization_fee.rs` module calculates the prioritization fee for a transaction, which is an important part of Solana's transaction processing system. The `PrioritizationFeeDetails` struct calculates the fee and priority fields based on the `PrioritizationFeeType` value and the `compute_unit_limit` value.

```rust
let fee_details = PrioritizationFeeDetails::new(fee_type, compute_unit_limit);
let (fee, priority) = fee_details.calculate_fee_and_priority();
```

The `sysvar_cache.rs` module provides a cache for system variables (sysvars) used by Solana programs. The `SysvarCache` struct stores the sysvars in memory as `Arc` pointers, allowing them to be shared across multiple program invocations and reducing the number of times they need to be fetched from the blockchain.

```rust
let mut sysvar_cache = SysvarCache::new();
sysvar_cache.add(sysvar_id, sysvar_data);
let sysvar_data = sysvar_cache.get(&sysvar_id);
```

These modules can be used by developers to create and deploy smart contracts on the Solana blockchain, optimizing the performance of the Solana program runtime and improving the overall performance of the Solana blockchain.